const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CmEYqMe3.js","./DhEqZVGG.js","./DAIss0ku.js","./1mwIFy_z.js","./5-o2xn5F.js"])))=>i.map(i=>d[i]);
import{_ as v}from"./1mwIFy_z.js";import{aI as $,w as y,aq as g}from"./5-o2xn5F.js";import{l as L}from"./D-IBFiEI.js";import{b as z}from"./D4OKE1ve.js";const W=!0;function p(e,t){const i=localStorage.getItem(e),a=y(i?JSON.parse(i):t);return a.subscribe(n=>localStorage.setItem(e,JSON.stringify(n))),a}const B=p("a11y-theme","light"),H=p("a11y-text-size","large"),ce=p("a11y-screen-reader",!1),de=p("a11y-reduced-motion",!1),x=p("a11y-tts-speed",.7),ue=p("a11y-phonetic",!0);p("a11y-simple-mode",!0);const me=p("a11y-arasaac-bw",!1),pe=$(H,e=>{switch(e){case"large":return"text-lg";case"extra-large":return"text-xl";default:return"text-base"}}),fe=$(B,e=>`theme-${e}`),N=[{id:"sv_SE-alma-medium",name:"Alma",lang:"sv",gender:"female",quality:"medium",sizeMb:63,description:"Alma — kvinnlig röst, tränad för barn med NPF"},{id:"sv_SE-nst-medium",name:"Axel",lang:"sv",gender:"male",quality:"medium",sizeMb:18,description:"Axel — manlig röst (NST)"},{id:"sv_SE-lisa-medium",name:"Lisa",lang:"sv",gender:"female",quality:"medium",sizeMb:18,description:"Lisa — kvinnlig röst"}],q=[{id:"en_US-hfc_female-medium",name:"HFC Female",lang:"en",gender:"female",quality:"medium",sizeMb:18},{id:"en_US-hfc_male-medium",name:"HFC Male",lang:"en",gender:"male",quality:"medium",sizeMb:18},{id:"en_US-amy-medium",name:"Amy",lang:"en",gender:"female",quality:"medium",sizeMb:18},{id:"en_US-joe-medium",name:"Joe",lang:"en",gender:"male",quality:"medium",sizeMb:18},{id:"en_US-lessac-medium",name:"Lessac",lang:"en",gender:"female",quality:"medium",sizeMb:18},{id:"en_US-kristin-medium",name:"Kristin",lang:"en",gender:"female",quality:"medium",sizeMb:18},{id:"en_US-danny-low",name:"Danny (light)",lang:"en",gender:"male",quality:"low",sizeMb:6},{id:"en_US-lessac-high",name:"Lessac (HD)",lang:"en",gender:"female",quality:"high",sizeMb:30}];function ge(e){return e==="sv"?N:q}const J={"sv_SE-lisa-medium":"sv/sv_SE/lisa/medium/sv_SE-lisa-medium.onnx","sv_SE-alma-medium":"sv/sv_SE/alma/medium/sv_SE-alma-medium.onnx"},T={"sv_SE-alma-medium":{model:"https://huggingface.co/yeagersthlm/piper-voice-sv-alma/resolve/main/sv_SE-alma-medium.onnx",config:"https://huggingface.co/yeagersthlm/piper-voice-sv-alma/resolve/main/sv_SE-alma-medium.onnx.json"},"sv_SE-lisa-medium":{model:"https://huggingface.co/rhasspy/piper-voices/resolve/main/sv/sv_SE/lisa/medium/sv_SE-lisa-medium.onnx",config:"https://huggingface.co/rhasspy/piper-voices/resolve/main/sv/sv_SE/lisa/medium/sv_SE-lisa-medium.onnx.json"}};let f=null;function F(){if(f!==null)return f;try{f=typeof window<"u"&&"__TAURI_INTERNALS__"in window}catch{f=!1}return f}async function K(e){if(!F())return null;try{const{resolveResource:t}=await v(async()=>{const{resolveResource:n}=await import("./CmEYqMe3.js");return{resolveResource:n}},__vite__mapDeps([0,1]),import.meta.url),{convertFileSrc:i}=await v(async()=>{const{convertFileSrc:n}=await import("./DhEqZVGG.js");return{convertFileSrc:n}},[],import.meta.url),a=await t(`voices/${e}`);return i(a)}catch(t){return console.warn("[TTS/Tauri] Failed to resolve local voice:",t),null}}const G={"sv_SE-alma-medium":{model:"sv_SE-alma-medium.onnx",config:"sv_SE-alma-medium.onnx.json"}},X=.5,R=y(localStorage.getItem("tts-voice-sv")||"sv_SE-alma-medium"),C=y(localStorage.getItem("tts-voice-en")||"en_US-hfc_female-medium");R.subscribe(e=>localStorage.setItem("tts-voice-sv",e)),C.subscribe(e=>localStorage.setItem("tts-voice-en",e));function j(e){return e==="sv"?g(R):g(C)}setTimeout(()=>S(),500);let O=!1,w=!1;const Y=y({engine:"none",piperReady:!1,piperFailed:!1,voiceCached:!1,lastSpoke:"",lastError:""});function u(e){Y.update(t=>({...t,...e}))}let b=null,m=null,k=null,I=!1;function Z(){const e=navigator.userAgent;return/iPad|iPhone|iPod/.test(e)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}function S(){return b?Promise.resolve(b):w?Promise.resolve(null):(k||(k=(async()=>{if(Z())return console.log("[TTS] iOS/iPadOS detected — using Web Speech API (Piper WASM not supported)"),w=!0,u({piperFailed:!0,engine:"webspeech",lastError:"iOS/iPadOS: Piper WASM stöds ej — använder Web Speech API"}),null;try{console.log("[TTS] Loading Piper WASM...");const e=await v(()=>import("./KIWwJmsM.js"),[],import.meta.url);e.env.wasm.numThreads=1,e.env.wasm.proxy=!1;const t=(z||"")+"/";e.env.wasm.wasmPaths=t,console.log(`[TTS] ONNX: threads=1, proxy=false, wasmPaths=${t}`);const i=await v(()=>import("./DAIss0ku.js"),__vite__mapDeps([2,3,4]),import.meta.url);return b=i,O=!0,u({piperReady:!0,engine:"piper"}),Q(i),console.log("[TTS] ✅ Piper WASM loaded"),i}catch(e){return console.error("[TTS] ❌ Piper WASM failed to load:",e),w=!0,u({piperFailed:!0,engine:"webspeech",lastError:String(e)}),null}})()),k)}function Q(e){if(!I)try{const t=e.PATH_MAP;if(t&&typeof t=="object")for(const[i,a]of Object.entries(J))i in t||(t[i]=a,console.log(`[TTS] Added ${i} to PATH_MAP`));else console.warn("[TTS] PATH_MAP not found on module — custom voices may not work");I=!0}catch(t){console.warn("[TTS] PATH_MAP patch failed:",t)}}async function P(e,t){const i=T[e];if(!i)return;const a=G[e];if(a&&F()){console.log(`[TTS] Loading bundled voice ${e} from Tauri resources`);for(const o of["model","config"]){const s=a[o],l=await K(s);if(!l){console.warn(`[TTS] Bundled file ${s} not found, falling back to network`);break}const r=await fetch(l);if(!r.ok){console.warn(`[TTS] Failed to fetch bundled ${s}: ${r.status}`);break}const c=await r.blob(),h=await(await(await(await navigator.storage.getDirectory()).getDirectoryHandle("piper",{create:!0})).getFileHandle(s,{create:!0})).createWritable();await h.write(c),await h.close(),console.log(`[TTS] Cached bundled ${s} in OPFS`),o==="model"&&t&&t({loaded:c.size,total:c.size})}return}console.log(`[TTS] Custom download for ${e} from ${i.model}`);const n=[{url:i.model,reportProgress:!0},{url:i.config,reportProgress:!1}];for(const o of n){const s=await fetch(o.url);if(!s.ok)throw new Error(`Failed to fetch ${o.url}: ${s.status}`);const l=+(s.headers.get("Content-Length")??0),r=s.body?.getReader(),c=[];let d=0;if(r)for(;;){const{done:V,value:M}=await r.read();if(V)break;c.push(M),d+=M.length,o.reportProgress&&t&&t({loaded:d,total:l})}const _=new Blob(c,{type:s.headers.get("Content-Type")??void 0}),h=await(await navigator.storage.getDirectory()).getDirectoryHandle("piper",{create:!0}),E=o.url.split("/").at(-1),A=await(await h.getFileHandle(E,{create:!0})).createWritable();await A.write(_),await A.close(),console.log(`[TTS] Cached ${E} in OPFS`)}}async function Se(e){const t=await S();if(!t)return;const i=e||g(L),a=j(i);try{let n=[];try{n=await t.stored()}catch{n=[]}n.includes(a)?console.log(`[TTS] Voice ${a} already cached`):(console.log(`[TTS] Downloading voice: ${a}...`),a in T?await P(a,o=>{const s=o.total?Math.round(o.loaded*100/o.total):0;console.log(`[TTS] Download ${a}: ${s}%`)}):await t.download(a,o=>{const s=o.total?Math.round(o.loaded*100/o.total):0;console.log(`[TTS] Download ${a}: ${s}%`)}),console.log(`[TTS] ✅ Voice ${a} ready`))}catch(n){console.error("[TTS] Voice preload failed:",n)}}async function he(){const e=await S();if(!e)return[];try{return await e.stored()}catch(t){console.warn("[TTS] stored() failed (corrupt IndexedDB?), clearing cache:",t);try{const i=await indexedDB.databases();for(const a of i)a.name&&(a.name.includes("piper")||a.name.includes("onnx"))&&(indexedDB.deleteDatabase(a.name),console.log(`[TTS] Deleted corrupt DB: ${a.name}`))}catch{}return[]}}async function we(e){const t=await S();if(t)try{await t.remove(e)}catch{}}const ee={autismappar:"auttism-appar",Autismappar:"Auttism-appar",ARASAAC:"arrasaak",TEACCH:"tiitch",PECS:"peks",LAMP:"lamp",account:"akkaunt",Account:"Akkaunt",AI:"ej-aj",audio:"åådio",Audio:"Åådio",backup:"backapp",Backup:"Backapp",bluetooth:"bluutooth",Bluetooth:"Bluutooth",bot:"bått",Bot:"Bått",browser:"bråwser",Browser:"Bråwser",buffer:"baffer",Buffer:"Baffer",cache:"käsj",Cache:"Käsj",cloud:"klaud",Cloud:"Klaud",cookie:"kuuki",Cookie:"Kuuki",cookies:"kuukis",Cookies:"Kuukis",dashboard:"däsjbord",Dashboard:"Däsjbord",debug:"diibagg",Debug:"Diibagg",delete:"diliit",Delete:"Diliit",download:"daunlåd",Download:"Daunlåd",email:"iimejl",Email:"Iimejl","e-mail":"iimejl",feedback:"fiidbäck",Feedback:"Fiidbäck",file:"fajl",File:"Fajl",folder:"fålder",Folder:"Fålder",game:"gejm",Game:"Gejm",GPS:"gee-pee-ess",guide:"gajd",Guide:"Gajd",HDMI:"hå-dee-emm-ii",homepage:"hoompeij",Homepage:"Hoompeij",like:"lajk",Like:"Lajk",load:"lood",Load:"Lood",login:"lågg-inn",Login:"Lågg-inn",logout:"lågg-aut",Logout:"Lågg-aut",notification:"nåttifikejsjon",Notification:"Nåttifikejsjon",notifications:"nåttifikejsjoner",Notifications:"Nåttifikejsjoner",offline:"åfflajn",Offline:"Åfflajn",online:"ånnlajn",Online:"Ånnlajn",password:"pässword",Password:"Pässword",player:"plejer",Player:"Plejer",playlist:"plejlist",Playlist:"Plejlist",podcast:"poddkast",Podcast:"Poddkast",profile:"proofil",Profile:"Proofil",reset:"riiset",Reset:"Riiset",restart:"riistaat",Restart:"Riistaat",save:"sejv",Save:"Sejv",score:"skåår",Score:"Skåår",screenshot:"skriinsjått",Screenshot:"Skriinsjått",scroll:"skråll",Scroll:"Skråll",server:"sörver",Server:"Sörver",share:"sjäär",Share:"Sjäär",stream:"striim",Stream:"Striim",streaming:"striiiming",Streaming:"Striiiming",support:"sapport",Support:"Sapport",swipe:"svajp",Swipe:"Svajp",sync:"synk",Sync:"Synk",timer:"tajmer",Timer:"Tajmer",tutorial:"tjuutårial",Tutorial:"Tjuutårial",update:"appdeijt",Update:"Appdeijt",upgrade:"appgrejd",Upgrade:"Appgrejd",upload:"applåd",Upload:"Applåd",URL:"u-err-ell",USB:"u-ess-bee",username:"juser-nejm",Username:"Juser-nejm",video:"viideo",Video:"Viideo",VPN:"vee-pee-enn",website:"webbsajt",Website:"Webbsajt",wifi:"wajfaj",WiFi:"wajfaj","Wi-Fi":"wajfaj",zoom:"zuum",Zoom:"Zuum",baby:"bejbi",Baby:"Bejbi",chat:"tjatt",Chat:"Tjatt",coach:"kåtj",Coach:"Kåtj",cool:"kuul",Cool:"Kuul",crazy:"krejsi",Crazy:"Krejsi",design:"disajn",Design:"Disajn",food:"fuud",Food:"Fuud",funny:"fanni",Funny:"Fanni",goal:"gool",Goal:"Gool",happy:"häppi",Happy:"Häppi",hoodie:"huudi",Hoodie:"Huudi",jeans:"jiins",Jeans:"Jiins",juice:"juus",Juice:"Juus",match:"mätj",Match:"Mätj",movie:"muuvi",Movie:"Muuvi",nice:"najs",Nice:"Najs",okay:"åkej",Okay:"Åkej",OK:"åkej",party:"paarti",Party:"Paarti",please:"pliis",Please:"Pliis",popcorn:"poppkårn",Popcorn:"Poppkårn",sandwich:"sändvitj",Sandwich:"Sändvitj",shopping:"sjåpping",Shopping:"Sjåpping",smoothie:"smuudi",Smoothie:"Smuudi",sneakers:"sniikers",Sneakers:"Sniikers",sorry:"sårri",Sorry:"Sårri",story:"ståri",Story:"Ståri",style:"stajl",Style:"Stajl",team:"tiim",Team:"Tiim",thanks:"tänks",Thanks:"Tänks","t-shirt":"tii-sjört","T-shirt":"Tii-sjört",weekend:"wiikend",Weekend:"Wiikend",iPad:"aj-pädd",Ipad:"aj-pädd",playdough:"plej-doo",Playdough:"Plej-doo",puzzle:"passel",Puzzle:"Passel",teddy:"teddi",Teddy:"Teddi",TikTok:"ticktock",tiktok:"ticktock",YouTube:"juutuub",Youtube:"juutuub",youtube:"juutuub"};function te(e,t){const i=t==="sv"?ee:{};let a=e;for(const[n,o]of Object.entries(i))a=a.replaceAll(n,o);return a}async function ve(e,t={}){if(oe(),!e||!W)return;const i=t.lang||g(L),a=g(x),n=t.rate??(a!==1?a:X);e=te(e,i);const o=await S();if(o)try{await D(o,e,i,n,t),u({engine:"piper",lastSpoke:e,lastError:""});return}catch(s){const l=String(s);if(console.error("[TTS] Piper speak error:",s),l.includes("JSON")||l.includes("Parse")||l.includes("Entry")){console.warn("[TTS] Corrupt cache detected, clearing and retrying...");try{const r=j(i);await o.remove(r),console.log(`[TTS] Removed corrupt cache for ${r}`),r in T?await P(r,c=>{const d=c.total?Math.round(c.loaded*100/c.total):0;console.log(`[TTS] Re-download ${r}: ${d}%`)}):await o.download(r,c=>{const d=c.total?Math.round(c.loaded*100/c.total):0;console.log(`[TTS] Re-download ${r}: ${d}%`)}),await D(o,e,i,n,t),u({engine:"piper",lastSpoke:e,lastError:""});return}catch(r){console.error("[TTS] Retry also failed:",r),u({lastError:`Piper retry: ${r}`})}}else u({lastError:`Piper speak: ${l}`})}console.warn("[TTS] Using Web Speech API fallback"),u({engine:"webspeech",lastSpoke:e}),ae(e,i,n,t)}async function D(e,t,i,a,n){const o=j(i);if(console.log(`[TTS] Piper: "${t}" (voice=${o}, rate=${a})`),o in T){let r=[];try{r=await e.stored()}catch{r=[]}r.includes(o)||(console.log(`[TTS] Auto-downloading custom voice ${o}...`),await P(o))}const s=await e.predict({text:t,voiceId:o});if(!s||s.size===0)throw new Error("Piper returned empty WAV");const l=new Audio;return l.src=URL.createObjectURL(s),l.playbackRate=a*.5,m=l,new Promise(r=>{l.onended=()=>{m=null,n.onEnd?.(),r()},l.onerror=c=>{console.error("[TTS] Audio error:",c),m=null,n.onEnd?.(),r()},l.play().catch(c=>{console.error("[TTS] play() failed:",c),m=null,r()})})}function ae(e,t,i,a){if(!("speechSynthesis"in window))return;const n=new SpeechSynthesisUtterance(e);n.lang=t==="sv"?"sv-SE":t==="en"?"en-US":t,n.rate=i,n.pitch=1;const o=speechSynthesis.getVoices(),s=j(t);if(s.startsWith("webspeech:")){const l=s.replace("webspeech:",""),r=o.find(c=>c.voiceURI===l);r&&(n.voice=r)}else{const l=n.lang.split("-")[0],r=o.find(d=>d.lang.startsWith(l)&&d.localService),c=o.find(d=>d.lang.startsWith(l));r?n.voice=r:c&&(n.voice=c)}a.onWord&&n.addEventListener("boundary",l=>{l.name==="word"&&a.onWord(l.charIndex,l.charLength)}),n.onend=()=>{a.onEnd?.()},speechSynthesis.speak(n)}function oe(){m&&(m.pause(),m.src="",m=null),"speechSynthesis"in window&&speechSynthesis.cancel()}function ye(){return O&&!w?"piper":"speechSynthesis"in window?"webspeech":"none"}export{me as a,W as b,oe as c,ye as d,H as e,B as f,he as g,ce as h,we as i,Se as j,R as k,C as l,x as m,fe as n,pe as o,ue as p,de as r,ve as s,Y as t,ge as v};
